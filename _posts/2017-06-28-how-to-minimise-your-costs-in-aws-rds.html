---
layout: post
status: publish
published: true
title: How to minimise your costs in aws rds
author:
  display_name: Naguib Ihab
  login: naguibihab
  email: nick@anideaforanapp.com
  url: ''
author_login: naguibihab
author_email: nick@anideaforanapp.com
excerpt: If you’re using AWS to host your applications then you’d probably be treading
  carefully when it comes to the RDS instances. AWS has…
wordpress_id: 31
wordpress_url: http://mycodelife.com/index.php/2017/09/28/how-to-minimise-your-costs-in-aws-rds/
date: '2017-06-28 04:25:25 +1000'
date_gmt: '2017-06-28 04:25:25 +1000'
categories:
- Techy
- aws
tags: []
comments: []
---
<p>How to minimise your costs in aws rds</p>
<article class="h-entry">
<section class="e-content" data-field="body">
<section class="section section--body section--first section--last">
<div class="section-content">
<div class="section-inner sectionLayout--insetColumn">
<p id="faa9" class="graf graf--p graf-after--h3">If you’re using AWS to host your applications then you’d probably be treading carefully when it comes to the RDS instances. AWS has introduced this nice new feature that allows you to stop an RDS instance which essentially deletes it and keeps a snapshot and just deploys that snapshot again when you want to start it, but it makes life a lot easier especially if you put that kind of function in a batch file and just run that file whenever you need to.</p>
<p id="54f2" class="graf graf--p graf-after--p">In this article I’ll show you how to stop your RDS instances automatically every night and start them up again in the morning using AWS CLI.</p>
<p id="42d3" class="graf graf--p graf-after--p"><strong class="markup--strong markup--p-strong">Prerequisite: You have to have already setup your AWS CLI with your account and are able to run AWS commands, follow </strong><a class="markup--anchor markup--p-anchor" href="http://docs.aws.amazon.com/cli/latest/userguide/cli-chap-getting-started.html" target="_blank" rel="noopener" data-href="http://docs.aws.amazon.com/cli/latest/userguide/cli-chap-getting-started.html"><strong class="markup--strong markup--p-strong">this link</strong></a><strong class="markup--strong markup--p-strong"> to set it up</strong></p>
<h3 id="39ab" class="graf graf--h3 graf-after--p">Running it from Windows</h3>
<h3 id="ce5f" class="graf graf--h3 graf-after--h3">Step #1 Update your CLI</h3>
<p id="e1c7" class="graf graf--p graf-after--h3">Update your CLI to the latest version by running <code class="markup--code markup--p-code">pip install --upgrade awscli</code> to upgrade or just <a class="markup--anchor markup--p-anchor" href="http://docs.aws.amazon.com/cli/latest/userguide/awscli-install-windows.html" target="_blank" rel="noopener" data-href="http://docs.aws.amazon.com/cli/latest/userguide/awscli-install-windows.html">download and install the latest version</a></p>
<p id="13e4" class="graf graf--p graf-after--p">Now when you type in <code class="markup--code markup--p-code">aws --version</code> in your terminal you should see something like this:</p>
<pre id="705e" class="graf graf--pre graf-after--p"><code class="markup--code markup--pre-code u-paddingRight0 u-marginRight0">C:<strong class="markup--strong markup--pre-strong">\Users\nick</strong>&gt;aws --version
aws-cli/1.11.109 Python/3.4.3 Windows/8 botocore/1.5.72</code></pre>
<p id="70d7" class="graf graf--p graf-after--pre">As I’m writing this on the 22nd of June 2017, the latest version for windows is 1.11.109</p>
<h3 id="8d9c" class="graf graf--h3 graf-after--p">Step #2 Writing the script</h3>
<p id="fe83" class="graf graf--p graf-after--h3">Create a new batch file <em class="markup--em markup--p-em">.bat</em> and write the following script</p>
<pre id="1a79" class="graf graf--pre graf-after--p"><code class="markup--code markup--pre-code">@echo off
set rdslist=rds-instance-1 rds-instance-2</code></pre>
<pre id="d160" class="graf graf--pre graf-after--pre"><code class="markup--code markup--pre-code u-paddingRight0 u-marginRight0">:retryaction
set /P action=Would you like to (1)start <strong class="markup--strong markup--pre-strong">or</strong> (2)stop these instances %rdslist%:</code></pre>
<pre id="969a" class="graf graf--pre graf-after--pre"><code class="markup--code markup--pre-code">IF %action%==1 (
    set command=start
    goto :start
)
IF %action%==2 (
    set command=stop
    goto :start
)</code></pre>
<pre id="e4e0" class="graf graf--pre graf-after--pre"><code class="markup--code markup--pre-code">goto :retryaction</code></pre>
<pre id="b0dd" class="graf graf--pre graf-after--pre"><code class="markup--code markup--pre-code u-paddingRight0 u-marginRight0">:start
(<strong class="markup--strong markup--pre-strong">for</strong> %%a in (%rdslist%) <strong class="markup--strong markup--pre-strong">do</strong> (
    call aws rds %command%-db-instance --db-instance-identifier %%a
))
pause</code></pre>
<p id="8c3f" class="graf graf--p graf-after--pre">And replace the <code class="markup--code markup--p-code">rds-instance</code> &amp; <code class="markup--code markup--p-code">rds-instance-2</code> with your own instances names.</p>
<p id="103f" class="graf graf--p graf-after--p">What we’re doing here is that we’re creating a list of our RDS instances and then iterating over each one and either stopping or starting them. What you should see when you run this script is the following:<br />
<code class="markup--code markup--p-code">Would you like to (1)start or (2)stop these instances rds-instance-1 rds-instance-2:</code><br />
once you choose the action you want to take the batch file will run the <code class="markup--code markup--p-code">start-db-instance</code> or <code class="markup--code markup--p-code">stop-db-instance</code> command on each of your RDS instances.</p>
<p id="0cdf" class="graf graf--p graf-after--p">You need to maintain that file and add,edit or delete RDS instances in that line 2.</p>
<h3 id="9735" class="graf graf--h3 graf-after--p">At this stage you’re able to run that batch file and start or stop RDS instances at anytime.</h3>
<h3 id="4e2e" class="graf graf--h3 graf-after--h3">Step #3 Automating the script</h3>
<p id="47c2" class="graf graf--p graf-after--h3">If you want to schedule it from your PC or windows server you can use the Task Scheduler</p>
<figure id="34bc" class="graf graf--figure graf-after--p">
<div class="aspectRatioPlaceholder is-locked" style="max-width: 478px; max-height: 792px;">
<div class="aspectRatioPlaceholder-fill" style="padding-bottom: 165.7%;"><img class="graf-image" src="https://cdn-images-1.medium.com/max/800/1*7KxtiZrPZ3npaVmbecJ-hw.png" data-image-id="1*7KxtiZrPZ3npaVmbecJ-hw.png" data-width="478" data-height="792" /></div>
</div>
</figure>
<p id="bddc" class="graf graf--p graf-after--figure">Once you open it click on <em class="markup--em markup--p-em">Create a Basic Task</em> and give it the name “Start RDS”. Continue with the wizard and select the trigger that you’re after, for example you may want the RDS instances to start when you start the computer, when you login or automatically at a particular time every day.<br />
Keep going until you get to this screen</p>
<figure id="8627" class="graf graf--figure graf-after--p">
<div class="aspectRatioPlaceholder is-locked" style="max-width: 700px; max-height: 499px;">
<div class="aspectRatioPlaceholder-fill" style="padding-bottom: 71.3%;"><img class="graf-image" src="https://cdn-images-1.medium.com/max/800/1*7gqwP4lLEfRfY8VDv07pdA.png" data-image-id="1*7gqwP4lLEfRfY8VDv07pdA.png" data-width="989" data-height="705" /></div>
</div>
</figure>
<p id="3cf9" class="graf graf--p graf-after--figure">Add in the path to your batch file and the argument <code class="markup--code markup--p-code">1</code></p>
<figure id="ac3d" class="graf graf--figure graf-after--p">
<div class="aspectRatioPlaceholder is-locked" style="max-width: 700px; max-height: 494px;">
<div class="aspectRatioPlaceholder-fill" style="padding-bottom: 70.6%;"><img class="graf-image" src="https://cdn-images-1.medium.com/max/800/1*dyN6xcHvNHafN6oIuEu3Fw.png" data-image-id="1*dyN6xcHvNHafN6oIuEu3Fw.png" data-width="987" data-height="697" /></div>
</div>
</figure>
<p id="db5a" class="graf graf--p graf-after--figure">Continue through the wizard and finish the task.<br />
Now we need to add a small modification to our script to have it accept parameters instead of prompting a question:</p>
<pre id="8f4d" class="graf graf--pre graf-after--p"><code class="markup--code markup--pre-code">@echo off
set rdslist=rds-instance-1 rds-instance-2</code></pre>
<pre id="fe7d" class="graf graf--pre graf-after--pre"><code class="markup--code markup--pre-code u-paddingRight0 u-marginRight0">IF %1==1 (
    set command=start
)
IF %1==2 (
    set command=stop
)
(<strong class="markup--strong markup--pre-strong">for</strong> %%a in (%rdslist%) <strong class="markup--strong markup--pre-strong">do</strong> (
    aws rds %command%-db-instance --db-instance-identifier %%a
))</code></pre>
<p id="8501" class="graf graf--p graf-after--pre">That’s it! You now have two bash files, one that you can run manually to shut down and start instances whenever you need them and one that can run on a scheduled time or trigger.</p>
<p id="8425" class="graf graf--p graf-after--p graf--trailing">Watch this space and I’ll publish how to do that using Linux pretty soon ;)</p>
</div>
</div>
</section>
</section>
</article>
<p>&nbsp;</p>
